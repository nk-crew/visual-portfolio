/*!
 * Flickr's Justified Gallery [fjGallery] v2.1.2 (https://flickr-justified-gallery.nkdev.info)
 * Copyright 2022 nK <https://nkdev.info>
 * Licensed under MIT (https://github.com/nk-o/flickr-justified-gallery/blob/master/LICENSE)
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).fjGallery=e()}(this,(function(){"use strict";let t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var e=t;function i(t,e,i){var o=(i||{}).atBegin;return function(t,e,i){var o,n=i||{},s=n.noTrailing,a=void 0!==s&&s,r=n.noLeading,h=void 0!==r&&r,c=n.debounceMode,l=void 0===c?void 0:c,g=!1,d=0;function u(){o&&clearTimeout(o)}function p(){for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];var r=this,c=Date.now()-d;function p(){d=Date.now(),e.apply(r,n)}function f(){o=void 0}g||(h||!l||o||p(),u(),void 0===l&&c>t?h?(d=Date.now(),a||(o=setTimeout(l?f:p,t))):p():!0!==a&&(o=setTimeout(l?f:p,void 0===l?t-c:t)))}return p.cancel=function(t){var e=(t||{}).upcomingOnly,i=void 0!==e&&e;u(),g=!i},p}(t,e,{debounceMode:!1!==(void 0!==o&&o)})}var o=function(t){var e=[],i=null,o=function(){for(var o=arguments.length,n=new Array(o),s=0;s<o;s++)n[s]=arguments[s];e=n,i||(i=requestAnimationFrame((function(){i=null,t.apply(void 0,e)})))};return o.cancel=function(){i&&(cancelAnimationFrame(i),i=null)},o},n={exports:{}};(n.exports=function(t){this.top=t.top,this.left=t.left,this.width=t.width,this.spacing=t.spacing,this.targetRowHeight=t.targetRowHeight,this.targetRowHeightTolerance=t.targetRowHeightTolerance,this.minAspectRatio=this.width/t.targetRowHeight*(1-t.targetRowHeightTolerance),this.maxAspectRatio=this.width/t.targetRowHeight*(1+t.targetRowHeightTolerance),this.edgeCaseMinRowHeight=t.edgeCaseMinRowHeight,this.edgeCaseMaxRowHeight=t.edgeCaseMaxRowHeight,this.widowLayoutStyle=t.widowLayoutStyle,this.isBreakoutRow=t.isBreakoutRow,this.items=[],this.height=0}).prototype={addItem:function(t){var e,i,o,n=this.items.concat(t),s=this.width-(n.length-1)*this.spacing,a=n.reduce((function(t,e){return t+e.aspectRatio}),0),r=s/this.targetRowHeight;return this.isBreakoutRow&&0===this.items.length&&t.aspectRatio>=1?(this.items.push(t),this.completeLayout(s/t.aspectRatio,"justify"),!0):a<this.minAspectRatio?(this.items.push(Object.assign({},t)),!0):a>this.maxAspectRatio?0===this.items.length?(this.items.push(Object.assign({},t)),this.completeLayout(s/a,"justify"),!0):(e=this.width-(this.items.length-1)*this.spacing,i=this.items.reduce((function(t,e){return t+e.aspectRatio}),0),o=e/this.targetRowHeight,Math.abs(a-r)>Math.abs(i-o)?(this.completeLayout(e/i,"justify"),!1):(this.items.push(Object.assign({},t)),this.completeLayout(s/a,"justify"),!0)):(this.items.push(Object.assign({},t)),this.completeLayout(s/a,"justify"),!0)},isLayoutComplete:function(){return this.height>0},completeLayout:function(t,e){var i,o,n,s,a,r=this.left,h=this.width-(this.items.length-1)*this.spacing;(void 0===e||["justify","center","left"].indexOf(e)<0)&&(e="left"),t!==(o=Math.max(this.edgeCaseMinRowHeight,Math.min(t,this.edgeCaseMaxRowHeight)))?(this.height=o,i=h/o/(h/t)):(this.height=t,i=1),this.items.forEach((function(t){t.top=this.top,t.width=t.aspectRatio*this.height*i,t.height=this.height,t.left=r,r+=t.width+this.spacing}),this),"justify"===e?(r-=this.spacing+this.left,n=(r-this.width)/this.items.length,s=this.items.map((function(t,e){return Math.round((e+1)*n)})),1===this.items.length?this.items[0].width-=Math.round(n):this.items.forEach((function(t,e){e>0?(t.left-=s[e-1],t.width-=s[e]-s[e-1]):t.width-=s[e]}))):"center"===e&&(a=(this.width-r)/2,this.items.forEach((function(t){t.left+=a+this.spacing}),this))},forceComplete:function(t,e){"number"==typeof e?this.completeLayout(e,this.widowLayoutStyle):this.completeLayout(this.targetRowHeight,this.widowLayoutStyle)},getItems:function(){return this.items}};
/*!
   * Copyright 2019 SmugMug, Inc.
   * Licensed under the terms of the MIT license. Please see LICENSE file in the project root for terms.
   * @license
   */
var s=n.exports;function a(t,e){var i;return!1!==t.fullWidthBreakoutRowCadence&&(e._rows.length+1)%t.fullWidthBreakoutRowCadence==0&&(i=!0),new s({top:e._containerHeight,left:t.containerPadding.left,width:t.containerWidth-t.containerPadding.left-t.containerPadding.right,spacing:t.boxSpacing.horizontal,targetRowHeight:t.targetRowHeight,targetRowHeightTolerance:t.targetRowHeightTolerance,edgeCaseMinRowHeight:.5*t.targetRowHeight,edgeCaseMaxRowHeight:2*t.targetRowHeight,rightToLeft:!1,isBreakoutRow:i,widowLayoutStyle:t.widowLayoutStyle})}function r(t,e,i){return e._rows.push(i),e._layoutItems=e._layoutItems.concat(i.getItems()),e._containerHeight+=i.height+t.boxSpacing.vertical,i.items}var h=function(t,e){var i={},o={},n={containerWidth:1060,containerPadding:10,boxSpacing:10,targetRowHeight:320,targetRowHeightTolerance:.25,maxNumRows:Number.POSITIVE_INFINITY,forceAspectRatio:!1,showWidows:!0,fullWidthBreakoutRowCadence:!1,widowLayoutStyle:"left"},s={},h={};return e=e||{},i=Object.assign(n,e),s.top=isNaN(parseFloat(i.containerPadding.top))?i.containerPadding:i.containerPadding.top,s.right=isNaN(parseFloat(i.containerPadding.right))?i.containerPadding:i.containerPadding.right,s.bottom=isNaN(parseFloat(i.containerPadding.bottom))?i.containerPadding:i.containerPadding.bottom,s.left=isNaN(parseFloat(i.containerPadding.left))?i.containerPadding:i.containerPadding.left,h.horizontal=isNaN(parseFloat(i.boxSpacing.horizontal))?i.boxSpacing:i.boxSpacing.horizontal,h.vertical=isNaN(parseFloat(i.boxSpacing.vertical))?i.boxSpacing:i.boxSpacing.vertical,i.containerPadding=s,i.boxSpacing=h,o._layoutItems=[],o._awakeItems=[],o._inViewportItems=[],o._leadingOrphans=[],o._trailingOrphans=[],o._containerHeight=i.containerPadding.top,o._rows=[],o._orphans=[],i._widowCount=0,function(t,e,i){var o,n,s,h=[];return t.forceAspectRatio&&i.forEach((function(e){e.forcedAspectRatio=!0,e.aspectRatio=t.forceAspectRatio})),i.some((function(i,s){if(isNaN(i.aspectRatio))throw new Error("Item "+s+" has an invalid aspect ratio");if(n||(n=a(t,e)),o=n.addItem(i),n.isLayoutComplete()){if(h=h.concat(r(t,e,n)),e._rows.length>=t.maxNumRows)return n=null,!0;if(n=a(t,e),!o&&(o=n.addItem(i),n.isLayoutComplete())){if(h=h.concat(r(t,e,n)),e._rows.length>=t.maxNumRows)return n=null,!0;n=a(t,e)}}})),n&&n.getItems().length&&t.showWidows&&(e._rows.length?(s=e._rows[e._rows.length-1].isBreakoutRow?e._rows[e._rows.length-1].targetRowHeight:e._rows[e._rows.length-1].height,n.forceComplete(!1,s)):n.forceComplete(!1),h=h.concat(r(t,e,n)),t._widowCount=n.getItems().length),e._containerHeight=e._containerHeight-t.boxSpacing.vertical,e._containerHeight=e._containerHeight+t.containerPadding.bottom,{containerHeight:e._containerHeight,widowCount:t._widowCount,boxes:e._layoutItems}}(i,o,t.map((function(t){return t.width&&t.height?{aspectRatio:t.width/t.height}:{aspectRatio:t}})))};function c(t,e){let i,o=!1,n=!1;const s=()=>{o?e(o):t.naturalWidth&&(o={width:t.naturalWidth,height:t.naturalHeight},e(o),clearInterval(i),n&&c())},a=()=>{s()},r=()=>{s()},h=()=>{0<t.naturalWidth&&s()},c=()=>{n=!1,t.removeEventListener("load",a),t.removeEventListener("error",r)};h(),o||(n=!0,t.addEventListener("load",a),t.addEventListener("error",r),i=setInterval(h,100))}const l=[],g=o((()=>{l.forEach((t=>{t.resize()}))}));var d;e.addEventListener("resize",g),e.addEventListener("orientationchange",g),e.addEventListener("load",g),d=()=>{g()},"complete"===document.readyState||"interactive"===document.readyState?d():document.addEventListener("DOMContentLoaded",d,{capture:!0,once:!0,passive:!0});let u=0;class p{constructor(t,e){const n=this;n.instanceID=u,u+=1,n.$container=t,n.images=[],n.defaults={itemSelector:".fj-gallery-item",imageSelector:"img",gutter:10,rowHeight:320,rowHeightTolerance:.25,maxRowsCount:Number.POSITIVE_INFINITY,lastRow:"left",transitionDuration:"0.3s",calculateItemsHeight:!1,resizeDebounce:100,isRtl:"rtl"===n.css(n.$container,"direction"),onInit:null,onDestroy:null,onAppendImages:null,onBeforeJustify:null,onJustify:null};const s=n.$container.dataset||{},a={};Object.keys(s).forEach((t=>{const e=t.substr(0,1).toLowerCase()+t.substr(1);e&&void 0!==n.defaults[e]&&(a[e]=s[t])})),n.options={...n.defaults,...a,...e},n.pureOptions={...n.options},n.resize=i(n.options.resizeDebounce,n.resize),n.justify=o(n.justify.bind(n)),n.init()}css(t,i){return"string"==typeof i?e.getComputedStyle(t).getPropertyValue(i):(Object.keys(i).forEach((e=>{t.style[e]=i[e]})),t)}applyTransition(t,e){const i=this;i.onTransitionEnd(t)(),i.css(t,{"transition-property":e.join(", "),"transition-duration":i.options.transitionDuration}),t.addEventListener("transitionend",i.onTransitionEnd(t,e),!1)}onTransitionEnd(t){const e=this;return()=>{e.css(t,{"transition-property":"","transition-duration":""}),t.removeEventListener("transitionend",e.onTransitionEnd(t))}}addToFjGalleryList(){l.push(this),g()}removeFromFjGalleryList(){const t=this;l.forEach(((e,i)=>{e.instanceID===t.instanceID&&l.splice(i,1)}))}init(){const t=this;t.appendImages(t.$container.querySelectorAll(t.options.itemSelector)),t.addToFjGalleryList(),t.options.onInit&&t.options.onInit.call(t)}appendImages(t){const i=this;e.jQuery&&t instanceof e.jQuery&&(t=t.get()),t&&t.length&&(t.forEach((t=>{if(t&&!t.fjGalleryImage&&t.querySelector){const e=t.querySelector(i.options.imageSelector);if(e){t.fjGalleryImage=i;const o={$item:t,$image:e,width:parseFloat(e.getAttribute("width"))||!1,height:parseFloat(e.getAttribute("height"))||!1,loadSizes(){const t=this;c(e,(e=>{t.width===e.width&&t.height===e.height||(t.width=e.width,t.height=e.height,i.resize())}))}};o.loadSizes(),i.images.push(o)}}})),i.options.onAppendImages&&i.options.onAppendImages.call(i,[t]),i.justify())}justify(){const t=this,e=[];t.justifyCount=(t.justifyCount||0)+1,t.options.onBeforeJustify&&t.options.onBeforeJustify.call(t),t.images.forEach((t=>{t.width&&t.height&&e.push(t.width/t.height)}));const i={containerWidth:t.$container.getBoundingClientRect().width,containerPadding:{top:parseFloat(t.css(t.$container,"padding-top"))||0,right:parseFloat(t.css(t.$container,"padding-right"))||0,bottom:parseFloat(t.css(t.$container,"padding-bottom"))||0,left:parseFloat(t.css(t.$container,"padding-left"))||0},boxSpacing:t.options.gutter,targetRowHeight:t.options.rowHeight,targetRowHeightTolerance:t.options.rowHeightTolerance,maxNumRows:t.options.maxRowsCount,showWidows:"hide"!==t.options.lastRow},o=h(e,i);if(o.widowCount&&("center"===t.options.lastRow||"right"===t.options.lastRow)){const e=o.boxes[o.boxes.length-1];let n=i.containerWidth-e.width-e.left;"center"===t.options.lastRow&&(n/=2),"right"===t.options.lastRow&&(n-=i.containerPadding.right);for(let t=1;t<=o.widowCount;t+=1)o.boxes[o.boxes.length-t].left=o.boxes[o.boxes.length-t].left+n}t.options.isRtl&&o.boxes.forEach(((t,e)=>{o.boxes[e].left=i.containerWidth-o.boxes[e].left-o.boxes[e].width-i.containerPadding.right+i.containerPadding.left}));let n=0,s=0;const a={};t.images.forEach(((e,i)=>{if(o.boxes[n]&&e.width&&e.height){if(t.options.calculateItemsHeight&&void 0===a[o.boxes[n].top]&&Object.keys(a).length&&(s+=a[Object.keys(a).pop()]-o.boxes[i-1].height),t.options.transitionDuration&&1<t.justifyCount&&t.applyTransition(e.$item,["transform"]),t.css(e.$item,{display:"",position:"absolute",transform:`translateX(${o.boxes[n].left}px) translateY(${o.boxes[n].top+s}px) translateZ(0)`,width:`${o.boxes[n].width}px`}),t.options.calculateItemsHeight){const t=e.$item.getBoundingClientRect();(void 0===a[o.boxes[n].top]||a[o.boxes[n].top]<t.height)&&(a[o.boxes[n].top]=t.height)}n+=1}else t.css(e.$item,{display:"none"})})),t.options.calculateItemsHeight&&Object.keys(a).length&&(s+=a[Object.keys(a).pop()]-o.boxes[o.boxes.length-1].height),t.options.transitionDuration&&t.applyTransition(t.$container,["height"]),t.css(t.$container,{height:`${o.containerHeight+s}px`}),t.options.onJustify&&t.options.onJustify.call(t)}updateOptions(t){const e=this;e.options={...e.options,...t},e.justify()}destroy(){const t=this;t.removeFromFjGalleryList(),t.justifyCount=0,t.options.onDestroy&&t.options.onDestroy.call(t),t.css(t.$container,{height:"",transition:""}),t.images.forEach((e=>{t.css(e.$item,{position:"",transform:"",transition:"",width:"",height:""})})),t.images.forEach((t=>{delete t.$item.fjGalleryImage})),delete t.$container.fjGallery}resize(){this.justify()}}const f=function(t,e,...i){("object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName)&&(t=[t]);const o=t.length;let n,s=0;for(;s<o;s+=1)if("object"==typeof e||void 0===e?t[s].fjGallery||(t[s].fjGallery=new p(t[s],e)):t[s].fjGallery&&(n=t[s].fjGallery[e].apply(t[s].fjGallery,i)),void 0!==n)return n;return t};f.constructor=p;const w=e.jQuery;if(void 0!==w){const t=f.constructor.prototype.init;f.constructor.prototype.init=function(){w(this.$container).data("fjGallery",this),t&&t.call(this)};const i=f.constructor.prototype.destroy;f.constructor.prototype.destroy=function(){this.$container&&w(this.$container).removeData("fjGallery"),i&&i.call(this)};const o=function(...t){Array.prototype.unshift.call(t,this);const i=f.apply(e,t);return"object"!=typeof i?i:this};o.constructor=f.constructor;const n=w.fn.fjGallery;w.fn.fjGallery=o,w.fn.fjGallery.noConflict=function(){return w.fn.fjGallery=n,this}}return f}));
//# sourceMappingURL=fjGallery.min.js.map
